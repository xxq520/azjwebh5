<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta name = "format-detection" content = "telephone=no">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<title>商品详情</title>
	<link rel="stylesheet" href="/goods/css/hui/hui.css">
	<link rel="stylesheet" href="/goods/css/main.css">
	<link rel="stylesheet" href="/goods/css/style.css">
	<link rel="stylesheet" href="/goods/css/hcx.css">
	<link rel="stylesheet" href="/goods/css/funing.css">
	<link rel="stylesheet" href="/goods/css/goodsAttr.css">
	<style type="text/css">
		/* ----------2018.5.15 商品详情新版样式 ------- begin ----------- */
		.hui-header h1 {
			font-size: 18px;
			height: 44px;
			line-height: 46px;
			overflow: hidden;
			padding: 0px 38px 0px 38px;
			text-align: center;
			font-weight: 400;
			white-space: nowrap;
			text-overflow: ellipsis;
			color: #212121;
		}
		.checkedMore {
			width: 38px;
			line-height: 42px;
			text-align: center;
			position: absolute;
			z-index: 1;
			right: 10px;
			top: 0px;
		}
		.checkedMore img {
			width: 1.25rem;
			margin-top: 0.8rem;
		}
		.pull-right {
			float: right !important;
		}
		.prBox .pull-right .ob {
			display: inline-block;
			text-align: center;
			color: #ff0000;
			font-size: 0.384rem;
			/* width: 1rem; */
			border: 1px solid #ff0000;
			height: 0.6rem;
			line-height: 0.65rem;
		}
		.prBox .pull-right .sale_goods {
			display: inline-block;
			padding-right: 0.3rem;
			border-right: 1px solid #717171;
			line-height: 0.6rem;
		}
		/* ----------2018.5.15 商品详情新版样式 ------- end ----------- */
		.imgBox img{width: 100%;height: 100%;}
		.hui-header {
			border-bottom: 1px solid #e2e2e2 !important;
		}

		.hui-tab-active .g-title {
			border-bottom: 2px solid #e4393c !important;
		}
		.hui-tab-title div {
			width: 33% !important;
			font-size: 0.6rem;
			border-bottom: none;
			line-height: 40px;
		}
		.hui-tab-title div {
			height: 42px;
			line-height: 42px;
			float: left;
			text-align: center;
			width: 20%;
			border-bottom: 2px solid #F4F5F6;
		}
		.hui-tab-item{
			position:relative !important;
		}
		.headerBox {
			width: 80%;
			height: 100%;
			margin: 0 auto;
		}

		.headerBox .headerItem {
			width: 50%;
			float: left;
		}

		.headerBox .headerItem.active .g-title {
			border-bottom: 2px solid #e4393c;
			color:#e4393c;
		}

		.pt_header {
			margin: 44px 0;
		}

		.gPrice {
			color: red;
		}

		.paramItem {
			border-bottom: 1px solid #e6e6e6;
		}
		/* .soshm-pop-sites{margin-top:200px;} */
		/* 复制提示 */
		.copy-tips {
			position: fixed;
			z-index: 999;
			top: 30%;
			left: 50%;
			margin: 0 0 -20px -80px;
			background-color: rgba(0, 0, 0, 0.2);
			filter: progid:DXImageTransform.Microsoft.Gradient(startColorstr=#30000000, endColorstr=#30000000);
			padding: 6px;
		}

		.copy-tips-wrap {
			padding: 10px 20px;
			text-align: center;
			border: 1px solid #F4D9A6;
			background-color: #FFFDEE;
			font-size: 14px;
		}

		.goodsImg img {
			width: 100%;
			height: auto;
		}

		.imgAndTxt img {
			width: 100%;
			height: auto;
			margin-top: -1px;
		}

		.goodsList .goodsItem .gImg img {
			height: 7rem;
		}


		.share-content {
			margin-top: 1rem;
		}

		.share-content .soshm-item {
			margin: 0;
			width: 25%;
		}

		.soshm-item .soshm-item-text {
			display: block;
			font-size: 14px;
			color: #212121;
			font-size: 0.512rem;
			margin-top: 4px;
		}

		.share-block ul {
			height: auto;
		}

		.share-block .share-content .soshm-item .soshm-item-icon {
			width: 40%;
			height: auto;
			margin-top: 2px;
		}

		.soshm-item-icon img {
			height: auto !important;
		}

		.ewmcode {
			position: fixed;
			margin-top: 80px;
			text-align: center;
			top: 1rem;
			left: 0;
			right: 0;
			width: 80%;
			margin: 0 auto;
			z-index: 666;
		}

		.share-block {
			position: fixed;
			z-index: 600;
		}

		.mask {
			opacity: 1;
			background: rgba(0, 0, 0, 0.5);
			z-index:900;
			position:fixed;
		}

		.ewmcode {
			width: 68%;
			text-align: center;
			z-index: 999;
		}

		.imgBox {
			height: inherit
		}
		}

		.share-block ul li img {
			width: 50%;
		}

		.sltBox .sltGood .sltDetail .slt-stock {
			font-size: .68rem;
			line-height: 1.08rem;
		}

		.styleColors {
			color: #999999;
		}
		/*图标字体开始*/
		@font-face {
			font-family: 'fontello';
			src: url('/common/font/fontello.eot?23036015');
			src:
					url('/common/font/fontello.eot?23036015#iefix')
					format('embedded-opentype'),
					url('/common/font/fontello.woff?23036015')
					format('woff'),
					url('/common/font/fontello.ttf?23036015')
					format('truetype'),
					url('/common/font/fontello.svg?23036015#fontello')
					format('svg');
			font-weight: 400;
			font-style: normal;
		}

		.font-ico {
			font-family: "fontello";
			font-style: normal;
			font-weight: normal;
			speak: none;
			display: inline-block;
			text-decoration: inherit;
			vertical-align: top;
			color: #000;
			font-size: 1.25rem;
			margin: 0 0 0 .1rem;
		}
		/*图标字体结束*/
		.go-back {
			position: absolute;
			left: 5%;
			top: 0;
			height: 2.5rem;
			line-height: 2rem;
			width: 10%;
			text-align: left;
			cursor: pointer;
		}

		body {
			padding-bottom: 2.4rem;
			/* position: absolute;
            min-width: 366px!important;
            max-width: 0px!important; */
		}
		.adressN{font-size: .68rem;}
		.adressN span{float:left;}
		.adressN .shopAddress{width:70%;margin-left:8px;}
		.sltBox .numBox label em{font-size: 70%;
			line-height: 100%;
			font-style: normal;
			color: #e4393c;}

		#spec {color: #130101}
		/*  .sltBox {height : 75%} */

		.specName {
			border-top: 1px solid #e2e2e2;
			width: 90%;
			margin: 0 auto;
		}
		.nogood{color:#ccc;}
		.sltBox {
			width: 100%;
			height: 20rem !important;
			overflow: auto;
			position: fixed;
			left: 0;
			background: #fff;
			border-top: 1px solid #e2e2e2;
			z-index: 1003;
			transition: all .5s;
		}
		.sltBox .sltGood .sltImg {
			width: 30% !important;
			height: 5rem;
			border: 1px solid #e2e2e2;
			float: left;
			text-align: center;
		}
		.sltBox .sltGood .sltDetail {
			float: left;
			padding-left: .6rem;
			padding-top: 0rem !important;
			width: 65% !important;
		}
		.sltBox .sltGood .sltDetail .slt-txt {
			font-size: .6rem !important;
			line-height: 1.08rem;
			overflow: hidden;
			text-overflow: ellipsis;
			display: -webkit-box;
			-webkit-box-orient: vertical;
			-webkit-line-clamp: 2;
		}

		.specBtn {
			width: 100%;
			height: 44px;
			line-height: 44px;
			position: fixed;
			background: #fff;
			bottom: 0;
		}
		.spec-box .spec-list .spec-item {
			width: auto;
			height: auto;
			font-size: .6rem;
			line-height: 0.8rem !important;
			border-radius: .6rem;
			float: left;
			padding: .2rem .8rem;
			background: rgb(245,245,245);
			margin: .2rem .4rem;
		}
		.spec-box .spec-list {
			border-bottom: 1px solid #e2e2e2;
			padding: .4rem 0 !important;
		}
		.spec-box .spec-list .spec-title {
			font-size: .7rem !important;
			color: #212121;
			line-height: 1.2rem;
		}
		.sltBox .numBox {
			/*position: fixed;*/
			/*bottom: 44px;*/
		}
		.numBox label{
			float: left;
		}
		.numBox .nbox{
			float: right;
		}
		.spec-box {
			border-top: 1px solid #e2e2e2;
			width: 90%;
			margin: 0 auto;
			height: 9.5rem;
			overflow: auto;
		}
		.g-titles{ color:red;}
		.imgBox{
			position:relative;
		}
		.imgBox .hui-swipe-item i.logo-618{
			display:block;
			position:absolute;
			right:0;
			top:2rem;
			width:3rem;
			height:3rem;
			/* background:url("/localQuickPurchase/distributionApp/images/618logo.jpg") no-repeat center;
            background-size:contain; */
		}
		.poster{
			position:absolute;
			left:0;
			right:0;
			bottom:5%;
			width:20%;
			margin:0 auto;
			border-radius:1rem;
			background:rgba(0,0,0,0.3);
			color:#d4d8d6;
			height:1.5rem;
			line-height:1.5rem;
			font-size:0.6rem;
			z-index:100;
		}
		.buyyel {
			color: #fff !important;
			background: #ffcc00 !important;
			border-top: 1px solid #ffcc00 !important;
		}
		.goodsImg {
			width: auto;
			height: auto;
		}
		.selfConfessed {font-size:14px}
		.manageBottominvestment {z-index:10}
		.hasDisplay{display: none;}

		.manageBottom .mbItem.mb30 {
			width: 40%!important;
		}

		.reciveBox{
			width: 100%;
			height: 20rem !important;
			overflow: auto;
			position: fixed;
			left: 0;
			background: #fff;
			border-top: 1px solid #e2e2e2;
			z-index: 1003;
			transition: all .5s;
		}

		.ReciveCloseBtn{
			position: absolute;
			right: .8rem;
			top: .8rem;
			width: .8rem;
			height: .8rem;
			background: url(/goods/images/closeIco.png) no-repeat center center;
		}

		.ReciveBuyNowBtn{
			color: #fff;
			background: #e4393c;
			border-top: 1px solid #e4393c;
			text-align: center;
		}


		.ReciveSpecBtn{
			width: 100%;
			height: 44px;
			line-height: 44px;
			position: fixed;
			background: #fff;
			bottom: 0;
			display: none;
		}

		.couponInfo{
			font-size: 17px;
			height: 35px;
			margin-top: 10px;
			padding-left: 5%;
		}

		.unRecive{
			text-decoration: none;
			color: #e4393c;
			display: inline-block;
			border: 1.5px solid black;
			width: 3.24rem;
			height: 1.07rem;
			border-radius: 1.33rem;
			line-height: 1.07rem;
			font-weight: bold;
			font-size: .53rem;
			margin-bottom: .22rem;
			text-align: center;
			position: absolute;
			right: 10px;
		}



		.hasRecive{
			text-decoration: none;
			color: #e8eef1;
			display: inline-block;
			border: 1.5px solid #e8eef1;
			width: 3.24rem;
			height: 1.07rem;
			border-radius: 1.33rem;
			line-height: 1.07rem;
			font-weight: bold;
			font-size: .53rem;
			margin-bottom: .22rem;
			text-align: center;
			position: absolute;
			right: 10px;
		}
		.dtFooter{
			z-index: 601;
		}

	</style>
</head>
<body>
<header class="hui-header"> <a href="javascript:;"
							   class="go-back"><i class="tb-left-ico font-ico">&#xe936;</i></a>
	<div class="shareTop" id="shareTops"></div>
	<h1>商品详情</h1>
	<!-- <div class="headerBox">
		<div class="headerItem active">
			<span class="g-title" id="g-title">商品</span>
		</div>
		<div class="headerItem">
			<span class="g-title" id="g-title">详情</span>
		</div>
	</div> -->
</header>
<div class="hui-wrap">
	<div class="goodsPage">
		<div class="goodsPage-item">
			<div class="imgBox">
				<div class="hui-swipe" id="swipe2">
				</div>
				<div class="poster makePosters" style="text-align:center;">保存海报</div>
			</div>
			<!-- 618活动小广告图  start-->
			<div class="banner-img" style="display: none;">
				<img src="/goods/images/banner-sm.jpg" />
			</div>
			<!-- 618活动小广告图  end-->
			<div class="detailBox">
				<div class="name-txt goodsName">
					<!-- 耐克新款roshow01轻快跑步鞋48521#4544555 -->
				</div>
				<div class="name-txt subtitle" style="font-size: 0.6rem;display: none;color: #909090;padding-top:1rem">
					<!-- 耐克新款roshow01轻快跑步鞋48521#4544555  副标题-->
				</div>
				<div class="prBox hui-list">
					<span class="pull-left font-md color_red"><!--分享好友下单立赚20.00元--></span>
					<a class="pull-right"><img id="shareTops" style="height: 0.55rem;" src="/goods/images/gd_share.png"></a>
				</div>
				<div class="prBox" >
					<div class="price-txt prItem styleColor">
						<label>价格：</label><i>&yen;</i><span
							class="value distributionPrice"> <!-- 138.5 -->
							</span>
						<span class="att goodsPrice" style="display: none;"></span>
					</div>
					<div class="pull-right">
						<span class="ob">严选</span>
						<!-- <span class="font-md-3 color_gray2" id="marketNum">已售1089</span> -->
						<span class="font-md-3 color_gray2 surplus_goods" style="display:none">剩余数量</span>
					</div>
					<span id="yTitle" class="hasDisplay" style="float: right;font-size: .7rem;margin-right: 1rem;color: red;">(预售商品)</span>
					<!-- <div class="num-txt prItem"><label>库存量：</label><span class="value">10000</span><span class="att">件</span></div> -->
				</div>
				<div class="prBox">
					<div class="num-txt prItem logisticsPrice">免运费</div>
					<div class="num-txt prItem distance"><span class="value range"></span></div>
				</div>
				<div class="adressN"><span>商家地址:</span><span class="shopAddress"></span></div>

				<div class="selfConfessed" style="display:none">
					剩余商品数量：<span class="selfConfessed-num">10</span>
				</div>
				<div class="hasDisplay" style="font-size: .68rem;color: #4c4c4c;">
					最迟发货时间：<span class="expectedDelivery" style="color:red;"></span>
				</div>

				<div class="specBox buyBtn">选择规格<span class="checkedSpec"></span>
					<span class="checkedMore">
            				<img src="/goods/images/gd_spec.png">
            			</span>
				</div>

				<div class="specBox choseCoupon" style="display:none;">领取优惠券<span class="checkedSpec"></span>
					<span class="checkedMore">
            				<img src="/goods/images/gd_spec.png">
            			</span>
				</div>
				<div class="eva" style="font-size: 0.75rem;margin: 1px -0.4rem;background-color: #e9e9e9;" >
					<div class="eva-comtant" style="margin: 0.3rem 0;padding:0.4rem;background-color: #ffffff;">
						<div>
							商品评价<span class="evaNum"></span>
							<span style="float: right;color: #ff0000" onclick="jumpEva(this)" >查看全部</span>
						</div>
					</div>
				</div>
				<div class="hui-tab">
					<div class="title-container"  style="position: absolute;z-index: 1;">
						<div class="hui-tab-title">
							<div class="btn-tab  hui-tab-active">图文详情</div>
							<div class="btn-tab">规格参数</div>
							<div class="btn-tab">购买须知</div>
						</div>
					</div>
					<!--通知tab-->
					<div class="hui-tab-body good-introduce" style="margin-top: 2.7rem;overflow:auto;height:auto">
						<div class="hui-tab-item hui-list no-padding">
							<!-- 618活动大广告图 start -->
							<div class="active-banner-box">
								<img src="/goods/images/618banner.png" />
							</div>
							<!-- 618活动大广告图 end -->
							<div class="imgAndTxt">
								<!--<img src="<%=path%>/distributionApp/images/inst.png" />-->
							</div>
						</div>
						<div class="hui-tab-item hui-list no-padding" style="display:none;">
							<div class="paramList"></div>
							<div class="goodsImg">
								<!--<img src="<%=path%>/distributionApp/images/goods.png" />-->
							</div>
							<div class="recommendBox goodsBox">
								<div class="goodsBox-header">商品推荐</div>
								<div class="goodsList"></div>
							</div>
						</div>
						<!--消息tab-->
						<div class="hui-tab-item hui-list no-padding" style="display:none;">
							<div class="txtBox">

								<div class="txtItem">
									<div class="txtHeader">正品保障</div>
									<div class="txtContent">
										爱之家商品由中国联合保险承保正品保证险,品质保证,100%正品，假一赔十。</div>
									<div class="txtHeader">服务保证</div>
									<div class="txtContent">
										爱之家商城为您提供"专业质检""严选品牌商""7天无理由退货"等服务,让您轻松购物有保障。</div>
									<div class="txtHeader">发货时间</div>
									<div class="txtContent">
										买家付款成功后的36小时内完成发货,一般配送时间在1-3天。</div>
									<div class="txtHeader">商品包邮</div>
									<div class="txtContent">
										爱之家支持全场包邮,部分偏远地区(如港澳台、新疆、西藏、内蒙古、青海等)除外。</div>
									<div class="txtHeader">七天退换</div>
									<div class="txtContent">
										用户自收到爱之家商品之日起,在保证商品不影响第二次销售的前提下,  7天内可享受无理由退换货(秒杀/活动商品除外)。</div>
									<div class="txtHeader">退货运费</div>
									<div class="txtContent">
										非产品质量问题产生退货,由买家承担运费;如产品质量有问题,由供货商承担运费,买家先垫付邮费,待确认收货后联系平台客服处理退货运费。</div>
									<div class="txtHeader">退款手续费</div>
									<div class="txtContent">
										您发起的退款申请将会产生1%的银行退款手续费,非商品质量问题发起的退货退款,该项费用将由买家承担。</div>
								</div>

							</div>
							<div class="recommendBox goodsBox">
								<div class="goodsBox-header">商品推荐</div>
								<div class="goodsList"></div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

	</div>
</div>

<!-- 底部管理栏 -->
<div class="manageBottom">
	<!--<c:choose>
		<c:when test="${'1' eq InvestMent }">
			<div class="manageBottominvestment">
				<div style="width: 100%;" id="justBuying" class="mbItem mb30 saleBtn">立即购买</div>
			</div>
		</c:when>
		<c:otherwise>-->
			<div class="mbItem mb20 cartBottom">
				<img src="/goods/images/shopcart.png">
				<p>购物车</p>
			</div>

			<div class="mbItem mb30 buyBtn">买</div>
			<div class="mbItem mb30 saleBtn" id="shareTops">卖</div>
		<!--</c:otherwise>
	</c:choose>-->
</div>

<!-- 消费者的底部管理栏 -->
<div class="dtFooter">
	<div class="manageBottominvestment manage-footer" style="display: none">
		<div style="width: 100%;" id="justBuying" class="mbItem mb30 saleBtn">立即购买</div>
	</div>
	<div class="goods-footer" style="display: none">
		<div class="dtItem dtLeft">
			<div class="icoBox"></div>
		</div>
		<div class="dtItem dtMiddle buyBtn">加入购物车</div>
		<div class="dtItem dtRight buyBtn">立即购买</div>
	</div>
</div>
<!-- 二维码 -->
<div class="mask">
	<div class="ewmcode" value="0">
		<img src="" />
	</div>
</div>

<div class="sltBox">
	<div class="closeBtn"></div>
	<div class="sltGood">
		<div class="sltImg goodsImg">
			<img src="" />
		</div>
		<div class="sltDetail">
			<div class="slt-txt styleColor slt-price yushou"></div>
			<!-- <div class="slt-txt">库存234件</div> -->
			<!-- <div class="slt-stock styleColors slt-stock">库存：<span class="stock-num">10</span></div> -->
			<div class="slt-stock styleColors slt-stock">
				起卖量：<span class="stock-num"></span>
			</div>
			<div class="slt-txt slt-spec">选择规格</div>
		</div>
	</div>
	<div class="spec-box" id="wrap1">
		<!-- <div class="spec-list">
        <div class="spec-title">颜色分类</div>
        <div class="spec-item">黑色</div>
        <div class="spec-item">白色</div>
        <div class="spec-item">绿色</div>
        <div class="spec-item">黄色</div>
        <div class="spec-item">红色</div>
    </div>
    <div class="spec-list">
        <div class="spec-title">鞋码</div>
        <div class="spec-item">36</div>
        <div class="spec-item">37</div>
        <div class="spec-item">38</div>
        <div class="spec-item">39</div>
        <div class="spec-item">40</div>
        <div class="spec-item">41</div>
        <div class="spec-item">42</div>
        <div class="spec-item">43</div>
    </div> -->
	</div>
	<div class="numBox" style="display:none;">
		<label>数量<em id="singular"><!--(最大下单数911)--></em></label>
		<div class="nbox">
			<div class="nbox-item nbox-reduce"></div>
			<div class="nbox-item nbox-input">
				<input type="text" class="nbox-txt" maxlength="3" name="numValue" value="1" />
			</div>
			<div class="nbox-item nbox-add"></div>
		</div>
	</div>
	<div class="manageBottominvestment" style="display: none">
		<div style="width: 100%;" id="justBuying" class="mbItem mb30 saleBtn">立即购买</div>
	</div>
	<div class="specBtn" style="display:none;">
		<div class="specBtn-item addCart">加入购物车</div>
		<div class="specBtn-item buyNow" >立即购买</div>
	</div>
</div>

<!---------------------------------------------------------领取优惠券隐藏层begin1----------------------------------------------------------->

<div class="reciveBox">
	<!--
    <h1 style="text-align: center">领取优惠券</h1>
    -->
	<div class="ReciveCloseBtn"></div>
	<h2 style="text-align: center;margin-top: 7%;">领取优惠券</h2>
	<div class="ReciveCoupons" style="position:absolute;top:3rem;left:0;bottom:2.5rem;width:100%;z-index:10;overflow:auto;" id="ReciveCoupons">
		<hr>
		<!--
        <div class="couponInfo">
            满200减50
            <a href="javascript:void(0);" class="btns unRecive">立即领券</a>
            <div class="activityBatchNo" style="display: none">活动分组</div>
            <div class="couponsId" style="display: none">123</div>
        </div>
        <hr>
        <div class="couponInfo">
            8.5折优惠
            <a href="javascript:void(0);" class="btns unRecive">立即领券</a>
            <div class="activityBatchNo" style="display: none">活动分组</div>
            <div class="couponsId" style="display: none">124</div>
        </div>
        <hr>
        <div class="couponInfo">
            立减300
            <a href="javascript:void(0);" class="btns hasRecive">已领取</a>
            <div class="activityBatchNo" style="display: none">活动分组</div>
            <div class="couponsId" style="display: none">125</div>
        </div>
        <hr>
        -->
	</div>
	<div class="ReciveSpecBtn">
		<div class="ReciveBuyNowBtn" num="goodsId" residual="quantity">关闭</div>
	</div>
</div>
<!---------------------------------------------------------领取优惠券隐藏层end----------------------------------------------------------->

<div class="share-block hui-text-center dis_share" style="height: 16rem"><!-- height: auto -->
	<div class="bringIn">分享商品</div>
	<p class="explain">只要你的好友通过你的链接买此商品，你就能得到此商品的利润哦~</p>
	<ul class="share-content">

	</ul>
	<ul style="overflow: hidden;">
		<li class="copylink"><img
				src="/goods/images/share_icon_5.png" />
			<p>二维码链接</p></li>
		<li class="shopCode" value="0"><img
				src="/goods/images/share_icon_4.png" />
			<p>二维码</p></li>
		<!--<li class="makePosters" value="0" ><img
            src="${path}/distributionApp/images/goodsLink.png" />
            <p>保存海报</p></li>-->
	</ul>
	<div class="hui-text-center" style="padding: 0 0 1rem;" id="closeShare">
		<img src="/goods/images/classfiyImg2.png" width="20">
	</div>
</div>

<script type="text/javascript" src="/common/lib/jquery.min.js"></script>
<script type="text/javascript" src="/common/js/tag.js"></script>
<script type="text/javascript" src="/common/js/userRole.js"></script>
<script type="text/javascript" src="/common/js/token.js"></script>
<script type="text/javascript" src="/common/js/common.js"></script>
<script type="text/javascript" src="/goods/js/sry.js"></script>
<script type="text/javascript" src="/common/lib/Hui/js/hui.js"></script>
<script type="text/javascript" src="/common/lib/Hui/js/hui-tab.js"></script>
<script type="text/javascript" src="/common/lib/Hui/js/hui-swipe2.js"></script>
<script type="text/javascript" src="/goods/js/clipboard.js"></script>
<script type="text/javascript" src="/goods/js/toolUtils.js"></script>
<script type="text/javascript" src="/goods/js/browsingHistory.js"></script>
<script type="text/javascript" src="/goods/js/soshm.js"></script>
<script type="text/javascript" src="/common/js/browser.min.js"></script>
<script type="text/javascript" src="/goods/js/goodsDetail.js"></script>
<script type="text/javascript">
    var goodsId = getGoodsId();
    var shareSeq = getShareSeq(); // 分享该商品的用户seq
    var isLocaleRecruitOrders = getLocaleRecruit();
    console.log(shareSeq);
    //新增浏览记录
    addGoodsHistoryBySeq(seq,goodsId);

    var shopSeq = 0;// 商品的seq
    var supplierSeq = 0;// 商品供货商的seq
    var goodsNum = 0;
    var lat = getCookie("lat");
    var lng = getCookie("lng");
    var goodsName = "";// 商品名
    var urlVal = window.location.href;// 该商品的地址
    var goodsState = true;// 判断商品是否上架
    var salesVolume = 1;// 起卖量
    var orderSku = "";
    var state;// 商品state
    var spec = "";//商品规格
    var proStandardsMap;//Map对象
    var goodsPrice;//市场价
    var ttype = "";
    var agentSeq = 0;
    var goodsCodeForCoupon;
    var goodsSkuList= [];//商品规格
	var companyName;//厂家
	var shareURL = "";
	var userSeq = 0;
    var logoStyle = "display:none;"

	//现场招商隐藏海报功能
    if(isLocaleRecruitOrder()){
        ttype = "1";
        agentSeq = getQueryString("shareSeq");
        if(agentSeq == '' || agentSeq  == 0){
            agentSeq = getCookie("shareSeq");
        }
        //隐藏海报功能
        $(".makePosters").addClass("hasDisplay");
        $(".shareTop").addClass("hasDisplay");
    }

    //强行同步函数顺序
    function doAsync(){
        // 初始化商品状态
        $.ajaxSettings.async = false;
        goodsInit();
    }

    function isLocaleRecruitOrder(){
        if(isLocaleRecruitOrders == "1"){
            return true;
        }
        return false;
    }

    // 获取商品详情
    function goodsInit() {
        // 商品信息
		var goodsDetailInit = {
            type : 'POST',
            dataType : 'json',
            url : '/goods/distributionGoods/loveHouseGoodsDetail',
            data : {
                goodsId : goodsId, // 5a41be3ac57a1c4eb44f3d40
                goodsType : ttype,
                agentSeq : agentSeq
            },
            async : false,
            success : function(data) {
                dataInit(data);
            }
		}
		if (!isLogin()){$.ajax(goodsDetailInit);return;};
        refresh(goodsDetailInit);
    }
    /**
	 * 商品数据渲染
	 */
	function dataInit(data) {
        if(null == data.data || null == data.data.goodsInfo){
            hui.alert('该商品已经下架！', ['返回首页'], function(){
                window.location.href="/localQuickPurchase/distributionVA/index";
            });
        }
        goods = data.data.goodsInfo;
        //分享的链接
        shareURL = data.data.shareURL;
        //用户seq
        userSeq = data.data.userSeq;
        //商品规格处理数据
        list = data.data.props;
        goodsSkuList = list.goodsList;

        if (goods != null) {
            //商品剩余销量
            handleSellSelfConfessed(goods);
			//规格获取
            getProStandardsMap(goods);
			//检查商品类型
            checkGoodsType();
            //商家地址展示
            handleShop(data.data.shopInfo);
            //页面展示数据渲染
            htmlDataRendering(goods);
            // 规格展示
            handleAttrList(list.attrList)
            //判断logo样式
            handleLogo(data.data.column);
            //商品图片--轮播
            handleGoodsImg(goods.listGoodsImg,goods.thumbnail);
           	//规格参数处理
			handleParameter(goods.parameter);
            // 图片轮播初始化
            swipeInit();
            //处理商品详情优惠券信息
            hasCoupons(data.data.coupons);
            //展示商品评价
            showEva(data.data.evaluation)
            var totalEvaluation = data.data.totalEvaluation
            if(totalEvaluation == null){
                totalEvaluation = 0;
            }
            $(".evaNum").html("("+ totalEvaluation +")");
        }
    }

    /**
	 * 处理商品的剩余销量
	 */
    function handleSellSelfConfessed(goods){
        var selfConfessed = goods.selfConfessed;//日供量
        var sellSelfConfessed = goods.sellSelfConfessed;//日卖供量
        if(selfConfessed != null && selfConfessed > 0) {
            if(sellSelfConfessed >= selfConfessed) {
                //商品日供量已售完
                $(".specBtn-item.buyNow").addClass("buyyel");
                $(".specBtn-item.buyNow").html("该商品今日已售罄~");

                $(".selfConfessed-num").html(0);
                $(".dtRight").addClass("buyyel");
                $(".dtRight").html("该商品今日已售罄~");
            } else {
                $(".selfConfessed-num").html(selfConfessed - sellSelfConfessed);
            }
        }
        var unit = goods.unit;//单位
        if(selfConfessed != null && selfConfessed != 0) {
            var surplusNum = selfConfessed - sellSelfConfessed;//日剩余量
            if (surplusNum > 0){
                $(".surplus_goods").show();
                $(".surplus_goods").html("剩余数量"+surplusNum+unit);
            }
        }
	}
    /**
     * 处理商家地址
     * @param shop
     */
    function handleShop(shop) {
        if (shop != null) {
            var adressDetail = "";
            if(shop.adressDetail != null && shop.adressDetail != ""){
                adressDetail = shop.adressDetail;
            }else{
                adressDetail = shop.province + shop.city + shop.area + shop.street;
                if(adressDetail == "" || adressDetail == null){
                    adressDetail = "没填写";
                }
            }
            $(".shopAddress").html(adressDetail);
        } else {
            $(".adressN").hide();
            $(".distance").hide();
        }
    }
    /**
     * 详情页数据渲染展示
     * @param goods
     */
    function htmlDataRendering(goods) {
        var goodsPsd = goods.goodsProStandard[0];
        var distributionPrice = goodsPsd.distributionPrice;
        goodsPrice = goodsPsd.goodsPrice;
        //商品金额
        $(".distributionPrice").html(distributionPrice);
        if(distributionPrice < goodsPrice ){
            $(".goodsPrice").html("￥" + (goodsPrice));
            $(".goodsPrice").show();
        }
        $(".slt-price").html("￥" + (distributionPrice));
        // 商品描述
        var introduction = goods.introduction;
        $(".imgAndTxt").html(introduction);
        //起卖量
        salesVolume = goodsPsd.salesVolume;
        $('.stock-num').html(salesVolume);
        //商品名
        goodsName = goods.goodsName;
        $(".goodsName").html(goodsName);
        //物流费
        var logisticsPrice = goods.logisticsPrice;
        if (logisticsPrice == null || logisticsPrice == 0) {
            $(".logisticsPrice").html("免运费");
        } else {
            $(".logisticsPrice").html("物流运费:" + logisticsPrice + "元");
        }
        //商品副标题
        var  subtitle = goods.subtitle;
        if(subtitle != null && subtitle != ""){
            $(".subtitle").html(subtitle);
            $(".subtitle").show();
        }
        //佣金显示
        if(isRoleAgent() || isRoleDealer()){
            var _distributionProfit = goodsPsd.distributionProfit;//分销商佣金
            var _profitPrice = goodsPsd.profitPrice;//代理商佣金
            //佣金显示
            showCommission(_distributionProfit, _profitPrice);
        }
        //商品上下架状态赋值
        var companyState = goods.companyState;
        // 商品状态
        state = goods.state;
        // 上下架判断
        if (!(shopSeq > 0)) {
            if (companyState != 0) {
                goodsState = false;
            }
        } else {
            if (state != 2) {
                goodsState = false;
            }
        }
        //商品标识
        presellType = goods.presellType;
        //开始时间
        statrtTime = goods.statrtTime;
        //结束时间
        endTime = goods.endTime;
        presellDay = goods.presellDay;
        //商品code
        goodsCodeForCoupon = goods.goodsCode;
        genreId = goods.genreId;
        //供应商名
        companyName = goods.companyName;
        if(goods.signColum == null || (goods.signColum).indexOf("严选") < 0) {
            $(".ob").hide();
        }
        //店铺seq
        shopSeq = goods.seq;
        //供应商seq
        if (goods.isDistrbutionGoods) {
            supplierSeq = goods.supplierSeq;
        } else {
            supplierSeq = goods.seq;
        }
        //分销商品库存赋值
        distributionStock = goodsPsd.stock;
        if(distributionStock == null || distributionStock == 0){
            distributionStock = 999;
        }
    }
    /**
     * 处理展示的规格
     * @param attrList
     */
    function handleAttrList(attrList) {
        var chooseSpec = '';
        for(var i = 0; i < attrList.length; i++) {
            var name = attrList[i].name;
            var attrValues = attrList[i].attrValues;

            chooseSpec +='<div class="spec-list attr-row">';
            chooseSpec += '<div class="spec-title">' + name + '</div>';
            for (var j = 0; j < attrValues.length; j++) {
                var attrValue = attrValues[j];
                var prime = attrValue.prime;
                var attrValue = attrValue.attrValue;
                chooseSpec += '<div class="spec-item" data-prime='+prime+' onclick="getSpces(this)" >' + attrValue + '</div>';
            }
            chooseSpec += '</div>';
        }
        $("#wrap1").html(chooseSpec);
    }
    /**
     * 处理banner的logo
     * @param column
     */
    function handleLogo(column) {
        if(column != null){
            if(column.logoURL != null && column.logoURL != "" &&
                column.logoBannerURL != null && column.logoBannerURL != "" &&
                column.activeBannerURL != null && column.activeBannerURL != "" ){
                logoStyle = "background: url("+ column.logoURL +")  no-repeat center;background-size: contain;";
                $(".banner-img img").attr("src",column.logoBannerURL);
                $(".banner-img").show();
                $(".active-banner-box img").attr("src",column.activeBannerURL);
                $(".active-banner-box").show();
            }
        }
    }
    /**
     * 处理商品图片
     * @param goodsImg      商品图片集合
     * @param thumbnail     商品缩略图
     */
    function handleGoodsImg(goodsImg,thumbnail) {
        var imgText = '';
        if(goodsImg == null) {
            imgText += '<div class="hui-swipe-item"><i class="logo-618" style="'+ logoStyle+'" ></i><img src="' + thumbnail + '"/></div>';
            $(".goodsImg").find("img").attr("src", thumbnail);
        } else {
            for (var i = 0; i < goodsImg.length; i++) {
                var goodsImgPath = goodsImg[i].goodsImgPath;
                imgText += '<div class="hui-swipe-item"><i class="logo-618" style="'+ logoStyle+'"></i><img src="' + goodsImgPath + '"/></div>';
            }
            $(".goodsImg").find("img").attr("src", goodsImg[0].goodsImgPath);
        }
        $("#swipe2").html(imgText);
    }
    /**
     * 规格参数处理
     * @param parameter     规格参数说明
     */
    function handleParameter(parameter){
        var specText = null;
        if(parameter != null && parameter.length > 0){
            for(var i = 0; i < parameter.length; i++){
                specText = '<li class="paramItem">'
                    + '<label class="paramName">' + (parameter[i].pName == null ? "" : parameter[i].pName) + '</label>'
                    + '<span class="paramValue checked">' + (parameter[i].pDName == null ? "" : parameter[i].pDName)
                    + '</span>' + '</li>';
                $(".paramList").append(specText);
            }
        }
    }
    /**
     * 轮播初始化
     */
    function swipeInit(){
        var swipe2 = new huiSwpie('#swipe2');
        swipe2.autoPlay = true;
        swipe2.speed=500;//切换图片的时间
        swipe2.delay=5000;//切换图片后停顿的时间  毫秒
        swipe2.run();
    }
    /**
	 * 获取规格集合
     * @param goodsProStandard
     * @param companyName
     * @param goodsCode
     */
    function getProStandardsMap(goods){
        var goodsProStandard = goods.goodsProStandard;
        if(goodsProStandard != null) {
            var length = goodsProStandard.length;
            proStandardsMap = new Array(length);
            for(var i = 0; i < length; i++) {

                var goodsProStandards = {};//对象
                goodsProStandards.sku = goodsProStandard[i].sku;//goodsSku
                goodsProStandards.distributionPrice = goodsProStandard[i].distributionPrice;//分销价
                goodsProStandards.platformPrice = goodsProStandard[i].platformPrice;//平台价
                goodsProStandards.salesVolume = goodsProStandard[i].salesVolume;//起卖量
                goodsProStandards.companyName = goods.companyName;//供应商名称
                goodsProStandards.goodsCode = goods.goodsCode;//商品Code
                goodsProStandards.factoryPrice = goodsProStandard[i].factoryPrice;//出厂价
                goodsProStandards.cost_unit_price = goodsProStandard[i].cost_unit_price;//出厂单价
                goodsProStandards.primitiveFactoryPrice = goodsProStandard[i].primitiveFactoryPrice;//原始出厂价
                goodsProStandards.distributionProfit = goodsProStandard[i].distributionProfit;//分销商佣金
                goodsProStandards.profitPrice = goodsProStandard[i].profitPrice;//代理商佣金

                var selectSpec = "";
                var specs = goodsProStandard[i].proStandAttached;
                if(specs != null) {
                    var standardName1 = specs.standardName1;
                    if(standardName1 != null) {
                        selectSpec += standardName1 + ",";
                    }
                    var standardName2 = specs.standardName2;
                    if(standardName2 != null) {
                        selectSpec += standardName2 + ",";
                    }
                    var standardName3 = specs.standardName3;
                    if(standardName3 != null) {
                        selectSpec += standardName3 + ",";
                    }
                    var standardName4 = specs.standardName4;
                    if(standardName4 != null) {
                        selectSpec += standardName4 + ",";
                    }
                    var standardName5 = specs.standardName5;
                    if(standardName5 != null) {
                        selectSpec += standardName5 + ",";
                    }
                    var standardName6 = specs.standardName6;
                    if(standardName6 != null) {
                        selectSpec += standardName6 + ",";
                    }
                    var standardName7 = specs.standardName7;
                    if(standardName7 != null) {
                        selectSpec += standardName7 + ",";
                    }
                    var standardName8 = specs.standardName8;
                    if(standardName8 != null) {
                        selectSpec += standardName8 + ",";
                    }
                }

                selectSpec = selectSpec.substring(0, selectSpec.length -1);
                goodsProStandards.selectSpec = selectSpec;//规格信息
                proStandardsMap[i] = goodsProStandards;
            }
        }
    }

    function gradationIndex(){
        var boolResult = false;
        $(".spec-box .spec-list:eq(0) .checked").each(function(index,item,array){
            boolResult = true;
        })
        return boolResult;
    }

    //商品加载
    goodsInit();
    // 初始化
    hotSale();

    var _uuid = $.cokie('uuid');
    if(_uuid == null) {
        var uuid = guid();
        $.cookie('uuid', uuid, { expires: 1, path: '/' });
    }

    if (seq == 0) {
        $(".manageBottom").remove();
    }else{
        /* 消费者、供应商不能上下架商品 */
        if (isRoleConsumer() || isRoleVip()) {
            $(".manageBottom").remove();
        } else {
            $(".dtFooter").remove();
        }
    }
    //商品结束tab切换
    $(".btn-tab").on("click",function(){
        var idx = $(this).index();
        $(this).addClass("hui-tab-active").siblings().removeClass("hui-tab-active")
        $(".good-introduce .hui-tab-item").eq(idx).show();
        $(".good-introduce .hui-tab-item").eq(idx).siblings(".hui-tab-item").hide();
    });

    //点击分享按钮
    $("body").on("click","#shareTops",function() {
        doAsync();
        if(!isLogin()){
            setCookie("loginRetrunUrl",urlVal);
            window.location.href="/localQuickPurchase/distributionVA/goodsDetail/goLogin";
        } else{
            // 分享
            var appUrl = shareURL;
            //判断是否是app
            var u = navigator.userAgent;
            //商品图片
            var shareGoodsPic = $(".hui-swipe-item").find("img:first").attr("src");
            // alert("-->" + shareGoodsPic);
            var isappwebview = u.indexOf('app_webview') > -1
            if(isappwebview){
                //点击分享
                share520Love(appUrl,goodsName,'',shareGoodsPic,'.share-content');
            } else{
                share520LoveWeb(appUrl,goodsName,'',shareGoodsPic,'.share-content');
                hui.dialogBase();
                $(".share-block").slideDown(200);
            }
        }
    });

    // 商品二维码
    $(".ewmcode img").attr("src",'/goods/shareQRCode/goodsCode/'+goodsId+"/"+userSeq);
    $(".ewmcode").hide();

    // 复制链接
    var clipboard = new Clipboard('.copylink', {
        // 点击copy按钮，直接通过text直接返回复印的内容
        text: function() {
            return shareURL;
        }
    });

    clipboard.on('success', function(e) {
        var $copysuc = $("<div class='copy-tips'><div class='copy-tips-wrap'>☺ 复制成功</div></div>");
        $("body").find(".copy-tips").remove().end().append($copysuc);
        $(".copy-tips").fadeOut(2000);
        e.clearSelection();
    });

    clipboard.on('error', function(e) {
        hui.toast('复制失败!');
    });

    $(".shopCode").click(function(){
        var ewmcodeVal = $(".ewmcode").attr("value");
        if(ewmcodeVal == "0"){
            $(".mask").show();
            $(".ewmcode").show();
            $(".ewmcode").attr("value","1");
        } else{
            $(".mask").hide();
            $(".ewmcode").hide();
            $(".ewmcode").attr("value","0");
        }
    });

    $(".makePosters").click(function(){
        var href = window.location.href;
        var urlsub= href.substring(0,href.indexOf("distributionVA/"))
        var urlstr= urlsub + "distributionVA/goodsDetail/"+goodsId+"/0/"+seq+"?checkShare=1&shareSeq="+seq;
        //调手机原生去下载；
        var u = navigator.userAgent;
        var isappwebview = u.indexOf('app_webview') > -1
        if(isappwebview){
            // 调app原生图片保存
            var  downImgParam= urlsub + "dGoodsAction/makePostersIO"+"?seq="+seq+"&goodsId="+goodsId + "&url="+urlstr;
            window.action.downImg(downImgParam);
        }else{
            downLoadImg("goods/distributionGoods/makePostersIO"+"?seq="+seq+"&goodsId="+goodsId + "&url="+urlstr,"shareRecuit.png");
        }
    });

    // 点击分享后弹出的背景层
    $(".mask").click(function(){
        $(".sharebox").removeClass('active');sltHide();
        $(".specBtn").hide();
        $(".numBox").hide();
        $(".ewmcode").hide();
        $(".ewmcode").attr("value","0");
        $(".ReciveSpecBtn").css("display","none");
    });

    $(".goodsPage-item").eq(0).show().siblings().hide();

    $(".hui-tab-title div").eq(0).click();

    var vh = $(".sltBox").height()+100;
    var vhr = $(".reciveBox").height()+200;

    function sltHide(){
        $(".mask").fadeOut("slow");
        $(".sltBox").css("bottom",-vh);
        $('.numBox').hide();
        $('.specBtn').hide();
        $(".reciveBox").css("bottom",-vhr);
    }

    var bool = true;//判断规格是否存在
    function sltShow(){
        $(".mask").fadeIn("slow");
        $(".sltBox").css("bottom",0);
        $(".reciveBox").css("bottom",-vhr);
        $(".ReciveSpecBtn").css("display","none");
    };

    //点击页面选择规格
    $(".buyBtn").click(function() {
        sltShow();
        var result = goodsOperation(2, presellType, statrtTime, endTime);
        $(".specBtn").show();
        if (result.code != 200) {
            $(".specBtn-item").addClass("hasDisplay");
            var size = $(".msg").length;
            var html = result.msg + "开始时间为：<span>" + (formatDateTime(statrtTime).split(" ")[0]) + "</span>";
            if (size > 0) {
                $("#msg").html(html);
            } else {
                $(".specBtn").append("<span id='msg' class='msg' style='color: red;font-size: .7rem;'>" + html + "</span>");
            }
        }

        setTimeout(function () {  $(".numBox").show(); }, 400);
        //关闭弹出层
        $(".closeBtn").click(function () {
            sltHide();
            $(".specBtn").hide();
            $(".numBox").hide();
        });
    });


    /* 获取规格的内容 */
    function getSpces(obj){
        if($(obj).hasClass("disabled")) {
            return;
        }
        $(".slt-spec").html("选择规格");

        $(".specBox.buyBtn").html("选择规格");
        var moreHtml = '<span class="checkedSpec"></span>' +
            '<span class="checkedMore"><img src="/goods/images/gd_spec.png"></span>';
        $(".specBox.buyBtn").append(moreHtml);
    }


    // 添加购物车
    $(".addCart").click(function(){
        if(!isLogin()){
            noLogin();
            return;
        }
        var result = goodsOperation(0,presellType,statrtTime,endTime);
        if(result.code != 200){
            hui.toast(result.msg);
            return ;
        }
        var num = $("input[name=numValue]").val();
        /* 商品规格选择判断 */
        var an = $(".spec-list").length;
        var sn = $(".spec-item.active").length;
        if(an != sn) {
            hui.toast("请选择商品规格");
            return;
        }
        goodsNum = num;
        console.info(spec);
        if(num<=0){
            hui.toast("该商品的起卖量是"+salesVolume);
            $("input[name=numValue]").val(salesVolume);
        } else if(num < salesVolume){
            hui.toast("该商品的起卖量是"+salesVolume);
            $("input[name=numValue]").val(salesVolume);
        } else if(num > distributionStock){
            hui.toast("最大订单数量为"+distributionStock);
        } else{
            doAsync();
            addCart();
        }
    });

    // 判断是否登录
    function noLogin(){
        sltHide();
        hui.confirm('为了给您提供完整的服务，请登录后再进行该操作', ['暂不登录','马上登录'], function(){
            setCookie("loginRetrunUrl",urlVal);
            loginPage()
        });
    }

    //立即购买
    $(".buyNow").click(function(){

        if(!isLogin()){noLogin();return;}

        var ishas = $(this).hasClass("buyyel");
        if(ishas) {
            return;
        }
        var result = goodsOperation(1,presellType,statrtTime,endTime);
        if(result.code != 200){
            hui.toast(result.msg);
            return ;
        }

        var num = Number($("input[name=numValue]").val());//商品数量
        var an = $(".spec-list").length;
        var sn = $(".spec-item.active").length;
        if(an != sn) {
            hui.toast("请选择商品规格");
            return;
        }

        goodsNum = num;
        if(num <= 0){
            hui.toast("该商品的起卖量是"+salesVolume);
            $("input[name=numValue]").val(salesVolume);
        } else if(num < salesVolume){
            //hui.toast("购买数量要大于起卖量!");
            hui.toast("该商品的起卖量是"+salesVolume);
            $("input[name=numValue]").val(salesVolume);
        } else if(num > distributionStock){
            hui.toast("最大订单数量为"+distributionStock);
        } else{
            doAsync();
            shopSeq = shopSeq == null ? 0 : shopSeq;
            supplierSeq = supplierSeq == null ? 0 : supplierSeq;

            try{
                //原生的立即购买
                window.action.app_buy(goodsId, goodsNum,  sku, spec, shareSeq)
            }catch(e){
            }
            var url = "/localQuickPurchase/distribution/html/placeOrder.jsp"+
                "?goodsId="+goodsId+"&shareSeq="+ shareSeq +"&quantity="+goodsNum+"&seq="+seq+"&shopSeq="+shopSeq+"&spec="+spec+"&sku="+orderSku+"&isLocaleRecruitOrders="+isLocaleRecruitOrders ;
            if(preselType == 1){
                var time = formatDateTime_(fun_date(endTime,presellDay));
                url += "&preselType=" +preselType + "&expectedDeliveryTime=" + time;
            }else{
                url += "&preselType=0";
            }
            window.location.href=url;
        }
    });

    var Num = {
        num:salesVolume == null ? 1 : salesVolume,
        maxNum:999,
        init:function(){
            $("input[name=numValue]").val(Num.num);
        },
        handle:function(){
            $("input[name=numValue]").change(function(){
                if(!checkNum($(this).val())){$(this).val(0);}
                if($(this).val()>=Num.maxNum){$(this).val(Num.maxNum);}
                Num.num = $(this).val();
            });
            $(".nbox-reduce").click(function(){
                if(!checkNum(Num.num)){$("input[name=numValue]").val(0);}
                if(Num.num==salesVolume){return;}
                var numNum = $("input[name=numValue]").val();
                numNum--;
                Num.num = numNum;
                if(numNum < salesVolume){
                    hui.toast("购买数量不能小于起卖量");
                    return;
                }
                $("input[name=numValue]").val(numNum);
            });
            $(".nbox-add").click(function(){
                if(!checkNum(Num.num)){$("input[name=numValue]").val(0);}
                if(Num.num>Num.maxNum){return;}
                var numNum = $("input[name=numValue]").val();
                numNum++;
                Num.num = numNum;
                if(numNum > Num.maxNum){
                    hui.toast("购买量不能大于"+distributionStock);
                    return;
                }
                $("input[name=numValue]").val(numNum);
            });
            function checkNum(n){
                var reg = /^[0-9]\d*$/;
                if(reg.test(n)){
                    return true;
                }else{
                    return false;
                }
            }
        }
    };

    $(function(){
        sltHide();
        Num.init();
        Num.handle();
    });
    hui(".hui-tab-title div").click(function(){
        var currentIndex=$(".hui-tab-body .hui-tab-item").eq($(this).index()).height()+54
        $(".hui-tab-body").css("height",currentIndex);
    });

    //商品详情
    $("body").on('click', '.good-pic', function() {
        var goodsId = $(this).attr('id');
        addGoodsHistoryBySeq(seq,goodsId);
        window.location.href="goodsDetail.html?goodsId="+goodsId+"&distributorSeq=0&shareSeq="+seq;
    });

    //购物车链接
    $("body").on('click', '.cartBottom', function() {
        window.location.href="/localQuickPurchase/distributionVA/shopCar";
    });

    $(function() {
        $("#closeShare").click(function() {
            hiddend();
        });

        function hiddend() {
            $("html,body").css("overflow", "visible");
            hui.dialogClose();
            $(".share-block").slideUp(200);
            $(".ewmcode").hide();
        }

        $("body").on("click", "#hui-mask", function() {
            hiddend();
        });
        $("body").on("click",".go-back",function() {
            var jumpUrl;
            try{
                var detailValue = getQueryString("detail");
                if(detailValue == "1"){
                    window.location.href="/app_back";
                }
            }catch(e){

            }
            jumpUrl = "/localQuickPurchase/distributionVA/index";

            var returnAddressUrl = document.referrer;
            if (returnAddressUrl == ""
                || returnAddressUrl.indexOf("login") > 0
                || returnAddressUrl.indexOf("Login") > 0) {
                window.location.href = jumpUrl;
            } else {
                hui.back();
            }
        });
    });

    function scrollTo(ele, speed){
        if(!speed) speed = 300;
        if(!ele){
            $("html,body").animate({scrollTop:0},speed);
        }else{
            if(ele.length>0) $("html,body").animate({scrollTop:$(ele).offset().top-400},speed);
        }
        return false;
    }

    //现场招募立即购买
    $(document).on('click','#justBuying',function(){
        if(!isLogin()){noLogin();return;}
        if(!bool){
            hui.toast("该规格已售完,请重新选择规格！");
            return;
        }

        var num = Number($("input[name=numValue]").val());//商品数量
        var an = $(".spec-list").length;
        var sn = $(".spec-item.active").length;
        if(an != sn) {
            $(".buyBtn").trigger("click");
            return;
        }

        goodsNum = num;
        if(num <= 0){
            //hui.toast("请选择购买数量!");
            hui.toast("该商品的起卖量是"+salesVolume);
            $("input[name=numValue]").val(salesVolume);
        } else if(num < salesVolume){
            //hui.toast("购买数量要大于起卖量!");
            hui.toast("该商品的起卖量是"+salesVolume);
            $("input[name=numValue]").val(salesVolume);
        } else if(num > 1000){
            hui.toast("最大订单数量为999");
        } else{
            doAsync();

            var idAndSeqs =new Array();
            var data = {};
            var logisticsPrice ;
            data.shopSeq=shopSeq;
            data.goodsId=goodsId;
            data.userName=userName;
            data.supplierSeq=supplierSeq;
            data.logisticsPrice=logisticsPrice;
            data.goodsSku=orderSku;
            data.goodsSpec=spec;
            data.quantity = goodsNum;
            data.shareSeq = shareSeq;
            idAndSeqs.push(data);
            selectParam(idAndSeqs);
        }
    });

    //讲所选的商品参数传到后台
    function selectParam(idAndSeqs) {
        $.ajax({
            type : "post",// 定义提交的类型
            url : "/localQuickPurchase/investmentGoods/selectParam",
            //traditional :true,
            contentType : "application/json;charset=utf-8",
            dataType : "json",// 设置返回值得类型
            data : JSON.stringify(idAndSeqs),
            async : false,// 是否异步请求，false为同步
            success : function(data) {// 成功返回值执行函数
                if (data.code == 200) {
                    investmentAccounts = data.data.redisKEY;
                    //判断是否登录
                    if(!isLogin()){
                        noLoginInvest(investmentAccounts);
                        return;
                    }
                    window.location.href="/localQuickPurchase/investmentGoods/settlement?redisKey="+data.data.redisKEY;
                } else {
                    hui.toast("跳转失败,系统异常请稍后再试!");
                }
            }
        });
    }

    //判断是否登录
    var shareSeqInvestMent = getQueryString("supplierSeq");
    function noLoginInvest(investmentAccounts){
        sltHide();
        $('.numBox').hide();
        hui.confirm('为了给您提供完整的服务，请登录后再进行该操作', ['暂不登录','马上登录'], function(){
            setCookie("loginRetrunUrl",urlVal);
            setCookie("investmentSeq",shareSeqInvestMent);//现场招商商家的seq
            setCookie("investmentAccounts",investmentAccounts);//现场招商商家的seq
            loginPage()
        });
    }

    /*-------------------------------------------优惠券js------begin---------------------------------------------*/
    function  hasCoupons(coupons){
        var couponsList = coupons
        if (couponsList != null) {
            var dataStr = couponsList.result;
            dataStr = eval('(' + dataStr + ')');
            var dataList = dataStr[1009].datas;
            console.log(dataList);
            if(dataList.length > 0){
                $(".choseCoupon").css("display","block");
                var reciveCouponDataList = "";
                for(var i = 0; i < dataList.length; i++){
                    var actBatchNo = dataList[i].actBatchNo;
                    var couponsId = dataList[i].couponsId;
                    var couponsTypeDesc = dataList[i].couponsTypeDesc;
                    //优惠券领取状态
                    var userReceiveStatus = dataList[i].userReceiveStatus;
                    var reciveCouponData = "<div class='couponInfo'>"+
                        couponsTypeDesc;
                    if(userReceiveStatus == 1){
                        reciveCouponData += "<a href='javascript:void(0);' class='btns unRecive'>立即领券</a>";
                    }else if(userReceiveStatus == 2){
                        reciveCouponData += "<a href='javascript:void(0);' class='btns hasRecive'>已领取</a>";
                    }else if(userReceiveStatus == 3){
                        reciveCouponData += "<a href='javascript:void(0);' class='btns hasRecive'>已结束</a>";
                    }
                    reciveCouponData += "<div class='activityBatchNo' style='display: none'>"+
                        actBatchNo+
                        "</div>"+
                        "<div class='couponsId' style='display: none'>"+
                        couponsId+
                        "</div>"+
                        "</div>"+
                        "<hr>";
                    reciveCouponDataList += reciveCouponData;
                }
                document.getElementById("ReciveCoupons").innerHTML = reciveCouponDataList;
            }
        }

    }

    //点击弹出领取优惠券层
    $(".choseCoupon").click(function(){
        if(!isLogin()){
            hui.confirm('为了给您提供完整的服务，请登录后再进行该操作', ['暂不登录','马上登录'], function(){
                loginPage()
            });
        }else {
            $(".mask").fadeIn("slow");
            $(".sltBox").css("bottom", -vh);
            $(".reciveBox").css("bottom", 0);
            $(".ReciveSpecBtn").css("display", "block");
        }
    });


    //点击关闭领取优惠券层
    $(".ReciveCloseBtn,.ReciveSpecBtn").click(function(){
        $(".mask").fadeOut("slow");
        $(".reciveBox").css("bottom",-vhr);
        $(".ReciveSpecBtn").css("display","none");
    });

    //点击领取优惠券
    $(document).on("click",".unRecive",function(){
        var thisParent = $(this).parent(".couponInfo");
        var thisCouponsId = $(this).parent(".couponInfo").find(".couponsId").text();
        var thisActBatchNo = $(this).parent(".couponInfo").find(".activityBatchNo").text();
        console.log(thisCouponsId  + "----------------------" + thisActBatchNo);
        var thisValue = $(this);
        if(thisCouponsId != null && thisCouponsId != "" && seq != null && seq != ""){
            $.ajax({
                type: 'POST',
                url: '/localQuickPurchase/couponCardBagAction/receiveAllcoupon',
                async: false,
                data : {
                    userSeq : seq,
                    couponsId : thisCouponsId,
                    actBatchNo : thisActBatchNo
                },
                success: function (data) {
                    if (data.code == 200) {
                        if(data.data.code == "200") {
                            //修改优惠券状态为已领取
                            thisValue.removeClass();
                            thisValue.addClass("btns hasRecive");
                            thisValue.text("已领取");
                        }
                        hui.alert(data.data.msg);
                    }else{
                        hui.alert("领取失败!");
                    }
                }
            });
        }
    });

    $(document).on("click",".hasRecive",function(){
        hui.alert("您已领取过该优惠券!!");
    });
    /*-------------------------------------------优惠券js------end---------------------------------------------*/
    function jumpEva(obj){
        window.location.href="/localQuickPurchase/distributionVA/orderEva/commentlist?goodsCode="+goodsCodeForCoupon+"&seq="+seq;
    }
    function showEva(eva){
        var _html ="暂无";
        if(eva != null){
            _html = '<div class="cm-item wbg mgTop" style="font-size: 0.65rem;;margin-top: 12px;display: inline-flex;line-height: 2rem;">'+
                '<img src="'+ eva.headImg +'" class="eva-img" style="height: 1.5rem;width: 1.5rem;border-radius: 1rem;"  onerror="this.src=\'/localQuickPurchase/distributionApp/images/head.png\'" />'+
                '<p class="fs30">'+ eva.nickName +'</p>'+
                '<p class="eva-time-p" style="position: absolute;right: 0;"><span class="fs22 gray2 eva-time" >'+ (eva.evaluateTime).substring(0,16) +'</span>'+
                '</div>'+
                '<p class="comment-text" style="display: -webkit-box;-webkit-box-orient: vertical;-webkit-line-clamp: 2;overflow: hidden;word-wrap: break-word;word-break: break-all;">'+ eva.evaluateContent +'</p>';
        }
        $(".eva-comtant").append(_html);
    }
    function getPriceForSelectSku(sku) {
        for(var i = 0; i < proStandardsMap.length; i++) {
            var getProStandard = proStandardsMap[i];
            var getSku = getProStandard.sku;
            if (getSku == sku) {
                spec = getProStandard.selectSpec;
                showSpecs(spec);
                var getDisPrice = getProStandard.distributionPrice;
                var getSalesVolume = getProStandard.salesVolume;
                $('.stock-num').html(getSalesVolume);//起卖量
                $(".slt-price").html("￥" + (getDisPrice));//分销价
                $(".distributionPrice").html(getDisPrice);
                $("input[name=numValue]").val(getSalesVolume);//
                //显示
                var getDisProfit = getProStandard.distributionProfit;
                var getProfitPrice = getProStandard.profitPrice;
                showCommission(getDisProfit, getProfitPrice);
            }
        }
    }

    //显示佣金
    function showCommission(distributionProfit, profitPrice) {
        var preferentialPrice = getCommission(distributionProfit, profitPrice);
        if(isRoleAgent() || isRoleDealer()) {
            if (isRoleAgent()) {
                $('.pull-left').html("分享好友下单立赚"+cutPriceDown(preferentialPrice)+"元")
            } else if (isRoleDealer()){
                $('.pull-left').html("分享好友下单立赚"+cutPriceDown(preferentialPrice)+"元")
            }
            var preferentialHtml = '<div class="slt-txt styleColor slt-price">优惠:'+cutPriceDown(preferentialPrice)+'</div>';
            $('.slt-price').append(preferentialHtml);
        }
    }

    /**
     * 根据当前用户类型获取佣金
     * @param distributionProfit
     * @param profitPrice
     */
    function getCommission(distributionProfit, profitPrice) {
        var preferentialPrice;
        if(isRoleAgent()) {
            preferentialPrice = distributionProfit;//分销商佣金
        } else if(isRoleDealer()) {
            preferentialPrice = numAdd(profitPrice, distributionProfit);//代理商佣金
        }
        return preferentialPrice;
    }

    /**
     * 规格显示
     * @param showSpec
     */
    function showSpecs(showSpec) {
        $(".slt-spec").text("已选择 " + showSpec);
        $(".specBox.buyBtn").html("已选择");
        $(".specBox.buyBtn").append('<span class="checkedSpec">'+showSpec+'</span>');
    }
</script>
<script type="text/babel">

    class GoodsAttr {
        constructor(options) {
            this.settings = {
                // 商品列表
                goodsList: [],

                // 此功能作用区块范围 - jquery对象
                jqWrap: $('#wrap'),
                // 高亮（选中）className
                activeCls: 'active',
                // 禁用className
                disabledCls: 'disabled',
                // 每个质数项的属性名
                primeAttr: 'data-prime',
                // 每个属性行的 className
                rowCls: 'attr-row',

                // 成功匹配到商品
                success(product) {
                    console.info(product);
                },
            };

            this.settings.goodsList = options.goodsList;
            this.settings.jqWrap = options.jqWrap;
            this.settings.success =  options.success;
            const settings = this.settings;

            // 乘积初始值
            this.multiplyResult = 1;

            // 所有属性行的集合
            this.jqRows = settings.jqWrap.find('.' + settings.rowCls);
            // 所有选项集合
            this.jqItems = settings.jqWrap.find('[' + settings.primeAttr + ']');

            // 未找到行或项
            if (this.jqRows.length === 0 || this.jqItems.length === 0) {
                throw 'No line|items found';
            }

            // 执行初始化
            this.init();

            // 绑定事件
            this.bindEvent();
        }

        // 初始化
        init() {
            // 1.禁用所有非选中项
            this.disableAll();
            // 2.计算乘积
            this.multiplys();
            // 3.每行处理
            this.rowHandle();
            // 4.返回结果重
            this.resultHandle();
        }

        // 绑定事件
        bindEvent() {
            const self = this;
            const settings = this.settings;

            settings.jqWrap.on('click', '[' + settings.primeAttr + ']', function () {

                if ($(this).hasClass(settings.activeCls)) {
                    $(this).removeClass(settings.activeCls);
                } else if($(this).hasClass(settings.disabledCls)) {
                    return;
                } else {
                    $(this).addClass(settings.activeCls).siblings().removeClass(settings.activeCls);
                }
                self.init();
            });
        }

        // 置灰所有未选中项
        disableAll() {
            const self = this;
            this.jqItems.each(function (index, item) {
                if (!$(item).hasClass(self.activeCls)) {
                    $(item).addClass(self.disabledCls)
                }
            });
        }

        // 选中项乘积
        multiplys() {
            this.multiplyResult = 1;

            const self = this;
            const settings = this.settings;
            const $actives = settings.jqWrap.find('.' + settings.activeCls);
            $actives.each(function (index, item) {
                self.multiplyResult *= $(item).attr(settings.primeAttr);
            });
        }

        // 每行属性处理
        rowHandle() {
            const self = this;
            const settings = this.settings;

            // 遍历每一行
            self.jqRows.each(function (index, item) {
                // 当前行所有项
                let $items = $(item).find('[' + settings.primeAttr + ']');
                // 当前行的质数
                let currentRowPrime = $(item).find('.' + settings.activeCls).attr(settings.primeAttr) || 1;
                // 其他所有行选中项的乘积
                let otherRowPrimeMultiply = self.multiplyResult / currentRowPrime;
                // 给当前行可用项去除禁用
                self.removeDisable($items, otherRowPrimeMultiply);
            });
        }

        // 给一行可用项去除禁用
        removeDisable($items, otherRowPrimeMultiply) {
            const self = this;
            const settings = this.settings;
            $items.each(function (index, item) {
                let prime = $(item).attr(settings.primeAttr);
                let list = settings.goodsList;
                let can = false;
                for (let i = 0; i < list.length; i++) {
                    if(list[i].productNumber % (prime * otherRowPrimeMultiply) === 0) {
                        can = true;
                    }
                }
                if (can) {
                    $(item).removeClass(settings.disabledCls);
                } else {
                    $(item).addClass(settings.disabledCls);
                }
            });
        }

        // 选中项乘积对应商品列表中的索引 不存在返回-1
        multiplyIndex() {
            // 计算乘积对应的key
            let idx = -1;
            let list = this.settings.goodsList;
            let hasProduct = false;
            for(let i = 0; i < list.length; i++) {
                idx = i;
                if(list[i].productNumber == this.multiplyResult) {
                    hasProduct = true;
                    break;
                }
            }
            return hasProduct ? idx : -1;
        }

        //结果处理
        resultHandle() {
            const index = this.multiplyIndex();
            const settings = this.settings;

            if (index > -1) {
                const product = settings.goodsList[index];
                if (typeof settings.success === 'function') {
                    settings.success(product);
                }
            } else {
                if (typeof settings.fail === 'function') {
                    settings.fail();
                }
            }
        }
    }
    //商品规格
    var goodsAttr1 = new GoodsAttr({
        jqWrap: $('#wrap1'),
        goodsList: goodsSkuList,
        success(product) {
            orderSku = product.sku;
            getPriceForSelectSku(orderSku);
        }
    });
</script>
</body>
</html>